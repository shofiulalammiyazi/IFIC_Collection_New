<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>360 Page -Right Side</title>
</head>
<body>
<div th:fragment="panel-right-collection">

    <div class="box box-primary ">
        <div class="box-header with-border">
            <h2 class="box-title label label-danger" style="margin-top: 10px;">Hot Note</h2>
            <a class=" btn btn-xs btn-primary pull-right" id="addHotNoteId" data-toggle="modal" data-target="#modal-hotnote">
                <i class="fa fa-plus-square"></i>
                Add More
            </a>
        </div>

        <div class="box-body">

            <div class="row" >
                <div class="col-md-12" style="max-height: 150px; overflow-y: auto;">
                    <table class="table   table-hover table-bordered" >
                        <thead>
                        <tr>
                            <td>Vip Status</td>
                            <td>Hot Note</td>
                            <td>Creator</td>
                            <td>Action</td>

                        </tr>
                        </thead>
                        <tbody id="hot-list">
                        <tr v-for="hote in hoteNoteList">
                            <td>{{hote.vipStatus}}</td>
                            <td>{{hote.hotNote}}</td>
                            <td>{{hote.username}}-{{hote.creatorPin}} / {{hote.createdDate | dateFormat}}</td>
                            <td>
                                <button v-if="designation != 'dealer'" title="Edit" id="loanHotNoteEdit" @click="editHotNote(hote.id)" data-toggle="modal" data-target="#modal-hotnote"><i class="fa fa-edit"></i></button>

                                <a style="margin-left:2px" class="btn btn-xs btn-info" @click="viewHotNote(hote.id)" data-toggle="modal" data-target="#modal-hn-view"> <i class="fa fa-eye"></i></a>
                            </td>

                        </tr>
                        </tbody>
                        <script>
                            var hotNote = new Vue({
                                el: '#hot-list',
                                data: {
                                    hoteNoteList: [],

                                    designation: designation,
                                },
                                created: function () {
                                    var host = window.location.host;
                                    var url = 'https://' + host + '/customerloanprofile/hotnote/list?id=' + customerId;
                                    this.$http.get(url,
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        if (res.body) {
                                            this.hoteNoteList = res.body;
                                        }
                                    }).catch(err => {
                                        console.log(err);
                                    })
                                },
                                filters: {
                                    dateFormat: function (value) {
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value) {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    }
                                },
                                methods: {
                                    upDateHoteNoteList: function (list) {
                                        this.hoteNoteList = list;
                                    },

                                    editHotNote: function (id) {

                                        $.ajax({
                                            url: '/customerloanprofile/hotnote/find?id='+id,
                                            success: function (response) {
                                                console.log(response);
                                                $("#loan_vipStatus").val(response.vipStatus);
                                                $("#editHotNoteId").val(response.id);
                                                $("#loan_hot_not_details").val(response.hotNote);
                                                $('#loan_status_flag option[value="'+response.statusFlag+'"]').attr('selected','selected');
                                            },
                                            error: function (response) {
                                                alert('Unsuccessful');
                                            }
                                        })
                                    },
                                    viewHotNote: function (id) {

                                        $.ajax({
                                            url: '/customerloanprofile/hotnote/find?id='+id,
                                            success: function (response) {
                                                console.log(response);
                                                $("#hn_vip_status").text(response.vipStatus);
                                                $("#hn_details").text(response.hotNote);
                                                $('#hn_status').text(response.statusFlag == true ? "Marked as Flag" : "Not Marked");
                                            },
                                            error: function (response) {
                                                alert('Unsuccessful');
                                            }
                                        })
                                    }
                                }
                            })


                        </script>
                    </table>
                </div>
            </div>

        </div>
        <div class="modal fade" id="modal-hotnote">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Create a Hot Note</h4>
                    </div>
                    <form id="hotNoteSaveForm" action="" method="post" class="form-horizontal"
                          onsubmit="loanHotNoteSave();return false;">

                        <input type="hidden" th:value="${loanprofileview.id}" name="customerBasicInfo.id"/>
                        <input type="hidden" name="id" value="" id="editHotNoteId"/>
                        <div class="modal-body">
                            <label>Select Vip Status<span class="text-red"></span></label>
                            <select id="loan_vipStatus" name="vipStatus" class="form-control">
                                <option>Select</option>
                                <option th:each="vipStatus : ${vipStatusList}"
                                        th:value="${vipStatus.name}" th:text="${vipStatus.name}"></option>
                            </select>
                            <label>Enter Details Here <span class="text-red"></span></label>
                            <textarea id="loan_hot_not_details" maxlength="500" class="form-control" rows="3" style="resize: none"
                                      placeholder="Enter Details Here" name="hotNote" ></textarea>
                            <label>Status<span class="text-red"></span></label>
                            <select id="loan_status_flag" name="statusFlag" class="form-control">
                                <option>Select</option>
                                <option th:value="${true}">Marked as Flag</option>
                                <option th:value="${false}">Not Marked</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger pull-left" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="modal fade" id="modal-hn-view">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" style="text-align: center">Hot Note</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="row top-buffer">
                            <label class="col-sm-2 custom-details-lebel-left"> Vip Status :</label>
                            <label class="col-sm-4 custom-form-lebel"  id="hn_vip_status"></label>

                            <label class="col-sm-2 custom-details-lebel-left">Status :</label>
                            <label class="col-sm-4 custom-form-lebel"  id="hn_status"></label>

                        </div>
                        <div class="row top-buffer">
                            <label class="col-sm-2 custom-details-lebel-left">Details :</label>
                            <label class="col-sm-10 custom-form-lebel"  id="hn_details" style="word-break: break-word;"></label>
                        </div>
                    </div>

                    <div class="modal-footer text-center">
                        <button type="button" class="btn btn-danger" id="dfds" data-dismiss="modal" >Close</button>
                    </div>

                </div>
            </div>
        </div>
        <script type="text/javascript" th:src="@{/customerprofileloan/hotnote.js}"></script>
    </div>

    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title" style="margin-top: 10px;">Activities Taken</h3>
            <a class=" btn btn-xs btn-primary pull-right" data-toggle="modal" onclick="ptpdetails()"  data-target="#modal-follow-up">
                <i class="fa fa-plus-square"></i>
                Add More
            </a>
        </div>
    </div>

    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title" style="margin-top: 10px;">Consideration as Attempt</h3>
        </div>

        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">
                <div class="col-md-12" style="max-height: 150px; overflow-y: auto;">
                    <table class="table  table-hover table-bordered">
                        <thead>
                        <td>Creator</td>
                        <td>Consideration as Attempt</td>
                        <td>Action</td>
                        </thead>
                        <tbody id="contact-list">
                        <tr v-for="contact in contactList">
                            <td :title="contact.createdBy+'-'+(contact.pin)+'/'+customDateFormat(contact.createdDate)">{{contact.createdBy}}-({{contact.pin}})</td>
                            <td>{{contact.attempt}}</td>
                            <td>
                                <a style="margin-left:2px" class="btn btn-xs btn-info" @click="viewCi(contact.id)" data-toggle="modal" data-target="#modal-ci-view"> <i class="fa fa-eye"></i></a>
                            </td>
                        </tr>
                        </tbody>
                        <script>
                            var contactInfo = new Vue({
                                el: '#contact-list',
                                data: {
                                    contactList: [],
                                    designation: designation,
                                },
                                created: function () {
                                    var host = window.location.host;
                                    var url = 'https://' + host + '/customerLoanProfile/ContactInfo/list?id=' + customerId;
                                    this.$http.get(url,
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        if (res.body) {
                                        this.contactList = res.body;
                                    }
                                }).catch(err => {
                                        console.log(err);
                                })
                                },
                                filters: {
                                    dateFormat: function (value) {
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value) {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    }
                                },
                                methods: {
                                    upDateContactList: function (list) {
                                        this.contactList = list;
                                    },
                                    customDateFormat(value){
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value) {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    },
                                    viewCi: function (id) {

                                        $.ajax({
                                            url: '/customerLoanProfile/ContactInfo/ById?id='+id,
                                            success: function (response) {
                                                console.log(response);
                                                $("#ci_attempt").text(response.ci.attempt);
                                                /*$("#ci_contact").text(response.ci.contact);
                                                $('#ci_category').text(response.ci.category);*/
                                            },
                                            error: function (response) {
                                                alert('Unsuccessful');
                                            }
                                        })
                                    }
                                }

                            })
                        </script>
                    </table>
                </div>
            </div>

        </div>

        <div class="modal fade" id="modal-ci-view">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">X</span></button>
                        <h4 class="modal-title" style="text-align: center">Consideration as Attempt</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="row top-buffer">
                            <label class="col-sm-4 custom-details-lebel-left"> Consideration as Attempt :</label>
                            <label class="col-sm-8 custom-form-lebel"  id="ci_attempt"></label>
                        </div>
                    </div>

                    <div class="modal-footer text-center">
                        <button type="button" class="btn btn-danger" id="dfds1" data-dismiss="modal" >Close</button>
                    </div>

                </div>
            </div>
        </div>


        <script type="text/javascript" th:src="@{/customerprofileloan/contactInfo.js}"></script>
    </div>


    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title" style="margin-top: 10px;">Consideration as Contact</h3>
        </div>

        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">
                <div class="col-md-12" style="max-height: 150px; overflow-y: auto;">
                    <table class="table table-striped table-hover table-bordered">
                        <thead>
                        <td>Creator</td>
                        <td>Consideration as Contact</td>
                        <td>Contact Category</td>
                        </thead>
                        <tbody id="contactOne-list">
                        <tr v-for="contactone in contactList">
                            <td :title="contactone.createdBy+'-'+(contactone.pin)+'/'+customDateFormat(contactone.createdDate)">{{contactone.createdBy}}-({{contactone.pin}})</td>
                        <td>{{contactone.contact}}</td>
                        <td>{{contactone.category}}</td>
                        <td>
                            <a style="margin-left:2px" class="btn btn-xs btn-info" @click="viewCiAsCon(contactone.id)" data-toggle="modal" data-target="#modal-ciascon-view"> <i class="fa fa-eye"></i></a>
                        </td>
                        </tr>
                        </tbody>

                        <script>
                            var contactInfoone = new Vue({
                                el: '#contactOne-list',
                                data: {
                                    contactList: [],
                                },
                                created: function () {
                                    var host = window.location.host;
                                    var url = 'https://' + host + '/customerLoanProfile/ContactInfo/list?id=' + customerId;
                                    this.$http.get(url,
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        if (res.body) {
                                        this.contactList = res.body;
                                    }
                                }).catch(err => {
                                        console.log(err);
                                })
                                },
                                filters: {
                                    dateFormat: function (value) {
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value) {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    }
                                },
                                methods: {
                                    upDateContactList: function (list) {
                                        this.contactList = list;
                                    },
                                    customDateFormat(value){
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value) {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    },
                                    viewCiAsCon: function (id) {

                                        $.ajax({
                                            url: '/customerLoanProfile/ContactInfo/ById?id='+id,
                                            success: function (response) {
                                                console.log(response);
                                                $("#ci_con_attempt").text(response.ci.attempt);
                                                $("#ci_con_contact").text(response.ci.contact);
                                                $('#ci_con_category').text(response.ci.category);
                                            },
                                            error: function (response) {
                                                alert('Unsuccessful');
                                            }
                                        })
                                    }
                                }

                            })
                        </script>
                    </table>
                </div>
            </div>

        </div>


        <div class="modal fade" id="modal-ciascon-view">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Consideration as Contact</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="row top-buffer">
                            <label class="col-sm-2 custom-details-lebel-left">Consideration as Contact :</label>
                             <label class="col-sm-4 custom-form-lebel"  id="ci_con_contact" style="word-break: break-word;"></label>

                            <label class="col-sm-2 custom-details-lebel-left">Contact Category :</label>
                            <label class="col-sm-4 custom-form-lebel"  id="ci_con_category"></label>
                        </div>
                    </div>

                    <div class="modal-footer text-center">
                        <button type="button" class="btn btn-danger" id="dsfsdef" data-dismiss="modal" >Close</button>
                    </div>

                </div>
            </div>
        </div>

        <script type="text/javascript" th:src="@{/customerprofileloan/contactInfo.js}"></script>
    </div>

    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title" style="margin-top: 10px;">Reason For Delinquency</h3>
        </div>

        <!-- /.box-header -->
        <div class="box-body">
            <div class="row" id="reasonDelinquencyAppId">
                <div class="col-md-12" style="max-height: 150px; overflow-y: auto;">
                    <table class="table table-striped table-hover table-bordered">
                        <thead>
                        <td>Creator</td>
                        <td>Date</td>
                        <td>Reason</td>
                        </thead>
                        <tbody>
                        <tr v-for="data in list">
                            <td>{{data.createdBy+'-'+data.dealerName}}</td>
                            <td>{{formatDate(data.createdDate)}}</td>
                            <td>{{data.reaDelinName}}</td>
                            <td>
                                <a style="margin-left:2px" class="btn btn-xs btn-info" @click="viewReasonDelinquency(data.id)" data-toggle="modal" data-target="#modal-delin-view"> <i class="fa fa-eye"></i></a>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                </div>
            </div>

            <script>

                var reasonDelinquencyApp = new Vue({
                    el: '#reasonDelinquencyAppId',
                    data: {
                        list: []
                    },
                    methods: {
                        formatDate: function (date) {
                            return formatDate_DD_MMM_YYYY(date)
                        },
                        viewReasonDelinquency: function (id) {
                            $.ajax({
                                url: '/collection/reason-delinquency/findById?id=' + id,
                                success: function (response) {
                                    console.log(response);
                                    $("#del_reason").text(response.reasonDelinquencies.reaDelinName);
                                    $("#del_dealerName").text(response.reasonDelinquencies.dealerName);
                                    $('#del_date').text(formatDate_DD_MMM_YYYY(response.reasonDelinquencies.createdDate));
                                },
                                error: function (response) {
                                    alert('Unsuccessful');
                                }
                            })
                        }
                    }
                })


                var getReasonDelinquency;

                $('document').ready(function () {

                    $('#reasonForDelinquencyForm input[name="accountNo"]').val(accountNo);

                    // getReasonDelinquency = function (customerId) {
                       getReasonDelinquency = function () {
                        var accNo = accountNo;
                        $.ajax({
                            // url: '/collection/reason-delinquency/find?id='+customerId,
                            url: '/collection/reason-delinquency/findByAc?id='+accNo,
                            success: function (response) {
                                reasonDelinquencyApp.list = response;
                            },
                            error: function (response) {
                                alert('Unsuccessful');
                            }
                        })
                    }
                    getReasonDelinquency();
                    // getReasonDelinquency(customerId);
                })
            </script>

        </div>

        <div class="modal fade" id="modal-delin-view">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Reason For Delinquency</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="row top-buffer">

                            <label class="col-sm-2 custom-details-lebel-left">Dealer Name</label>
                            <label class="col-sm-4 custom-form-lebel"  id="del_dealerName"></label>

                            <label class="col-sm-2 custom-details-lebel-left">Date</label>
                            <label class="col-sm-4 custom-form-lebel"  id="del_date"></label>
                        </div>
                        <div class="row top-buffer">


                            <label class="col-sm-2 custom-details-lebel-left">Reason :</label>
                            <label class="col-sm-10 custom-form-lebel"  id="del_reason" style="word-break: break-word;"></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" >Close</button>
                    </div>

                </div>
            </div>
        </div>

        <script type="text/javascript" th:src="@{/customerprofileloan/contactInfo.js}"></script>
    </div>

    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title" style="margin-top: 10px;">Note Detail</h3>
        </div>

        <!-- /.box-header -->
        <div class="box-body">
            <div class="row">
                <div class="col-md-12" style="max-height: 150px; overflow-y: auto;">
                    <table class="table  table-hover table-bordered">
                        <thead>
                        <td>Creator</td>
                        <td>Memo Note</td>
                        </thead>
                        <tbody id="memo-list">
                        <tr v-for="memo in memoNoteList">
                            <td :title="memo.createdBy+'-'+(memo.pin)+'/'+customDateFormat(memo.createdDate)">{{memo.createdBy}}-({{memo.pin}})</td>
                            <td>{{memo.note}}</td>
                            <td>
                                <a style="margin-left:2px" class="btn btn-xs btn-info" @click="viewNoteDetail(memo.id)" data-toggle="modal" data-target="#modal-nd-view"> <i class="fa fa-eye"></i></a>
                            </td>
                        </tr>
                        </tbody>


                        <script>
                            var memoList = new Vue({
                                el: '#memo-list',
                                data: {
                                    memoNoteList: [],
                                },
                                created: function () {

                                    var accountNo = profile_information.accountNo;

                                    var host = window.location.host;
                                    var url = 'https://' + host + '/customerloanprofile/dailynote/listAccount?id=' + accountNo;
                                    // var url = 'https://' + host + '/customerloanprofile/dailynote/list?id=' + customerId;
                                    this.$http.get(url,
                                        {
                                            credentials: true, headers: {
                                                'X-CSRF-TOKEN': window.csrfToken,
                                            }
                                        }).then(res => {
                                        if (res.body) {
                                            this.memoNoteList = res.body;
                                        }
                                    }).catch(err => {
                                        console.log(err);
                                    })
                                },

                                filters: {
                                    dateFormat: function (value) {
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value != '') {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    }
                                },

                                methods: {
                                    upDateMemoNoteList: function (list) {
                                        this.memoNoteList = list;
                                    },
                                    customDateFormat(value){
                                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                        ];
                                        if (value) {
                                            var date = new Date(value);
                                            var day = date.getDate();
                                            if (day < 10) day = '0' + day;
                                            var hours = date.getHours();
                                            var minutes = date.getMinutes();
                                            var newFormat = hours >= 12 ? "PM" : "AM";
                                            hours = hours % 12;
                                            hours = hours ? hours : 12;
                                            minutes = minutes < 10 ? '0' + minutes : minutes;
                                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                        } else {
                                            return "";
                                        }
                                    },
                                    viewNoteDetail: function (id) {
                                        $.ajax({
                                            url: '/customerloanprofile/dailynote/ById?id=' + id,
                                            success: function (response) {
                                                $("#dn_accountNo").text(response.dn.accountNo);
                                                $("#dn_note").text(response.dn.note);
                                                $('#dn_createdBy').text(formatDate_DD_MMM_YYYY(response.dn.createdDate));
                                            },
                                            error: function (response) {
                                                alert('Unsuccessful');
                                            }
                                        })
                                    }
                                }

                            })
                        </script>
                    </table>
                </div>
            </div>

        </div>
        <div class="modal fade" id="modal-dailynote">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">Create Daily Note / Memo</h4>
                    </div>

                </div>
            </div>
        </div>

        <div class="modal fade" id="modal-nd-view">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">X</span></button>
                        <h4 class="modal-title">Note Detail</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="row top-buffer">
                            <label class="col-sm-2 custom-details-lebel-left">Account No :</label>
                            <label class="col-sm-4 custom-form-lebel"  id="dn_accountNo"></label>
                            <label class="col-sm-2 custom-details-lebel-left">Date :</label>
                            <label class="col-sm-4 custom-form-lebel"  id="dn_createdBy"></label>

                        </div>
                        <div class="row top-buffer">
                            <label class="col-sm-2 custom-details-lebel-left">Note :</label>
                            <label class="col-sm-10 custom-form-lebel"  id="dn_note" style="word-break: break-word;"></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" >Close</button>
                    </div>

                </div>
            </div>
        </div>

        <script type="text/javascript" th:src="@{/customerprofileloan/dailynote.js}"></script>
    </div>



    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">Follow Up</h3>
        </div>

        <div class="box-body" style="overflow: auto; max-height: 300px;">

            <div class="row">
                <div class="modal fade" id="modal-follow-up" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 80%">
                        <div class="modal-content col-sm-12" style="border-radius: 8px">
                            <div class="modal-header ">
                                <label class="box-title" style="font-size: 18px">Call Activity</label>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  X
                                </button>
                            </div>
                            <div class="col-sm-12">
                                <div class="box box-primary" >
                                    <div class="csi-view-form-full-area csi-view-indtable col-sm-6" id="considerAttemptId" style="padding: 12px; !important;">
                                        <div class="box-header with-border csi-view-box-header">
                                            <label class="box-title" >Consideration as Attempt</label>
                                        </div>
                                        <div class="box-body" >
                                            <form id="considerAttemptForm" action="" method="post" class="form-horizontal">
                                                <input type="hidden"  th:value="${loanprofileview.id}" id="considerationAttemptCustomerId"
                                                       name="customerBasicInfo.id"/>
                                                <div >
                                                    <!-- select -->
                                                    <input type="hidden" name="consider_attempt_details" id="consider_attempt" value=""/>
                                                    <input type="hidden" name="considet_contact_details" id="considet_contact" value=""/>
                                                    <input type="hidden" name="contact category_details" id="contact category" value=""/>
                                                    <div class="form-group">
                                                        <br>
                                                        <br>
                                                        <label class="col-sm-2 control-label">Consideration as Attempt</label>
                                                        <div class="col-sm-10">
                                                            <select id="consider_attempt_id" name="attempt" class="form-control consider-attempt-loan" required='required' >
                                                                <option value="">Select One</option>
                                                                <option v-for="data in considerAttemptList" v-bind:value="data.attemptName">{{data.attemptName}}</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <br>
                                                    <div class="form-group">
                                                        <label class="col-sm-2 control-label">Consideration as Contact</label>
                                                        <div class="col-sm-4">
                                                            <select id="considet_contact_id" name="contact"
                                                                    class="form-control" required='required'>
                                                                <option value="">Select One</option>
                                                            </select>
                                                        </div>
                                                        <label class="col-sm-2 control-label">Contact Category</label>
                                                        <div class="col-sm-4">
                                                            <select id="contact_category_id" name="category"
                                                                    class="form-control" required='required'>
                                                                <option value="">Select One </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                         <br>
                                                     </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                    <script>
                                        var considerAttemptApp = new Vue({
                                            el: '#considerAttemptId',
                                            data: {
                                                considerAttemptList: [],
                                                considerAttemptListById: []
                                            },

                                        })

                                        $(document).ready(function () {

                                            function considerAttemptList(customerId) {
                                                $.ajax({
                                                    url: "/collection/considerAttempt/attemptList/loan",
                                                    success: function (data) {
                                                        considerAttemptApp.considerAttemptList= data;
                                                    },
                                                    error: function (data) {
                                                        //alert("Failure!");
                                                    }
                                                });
                                            }
                                            considerAttemptList(customerId);

                                            $('#consider_attempt_id').on('change', function () {
                                                let id = $(this).val();
                                                $('#considet_contact_id, #ptp_contact_details_id').html('<option value="">Select One </option>')
                                                $('#contact_category_id, #ptp_promisor_details_id').html('<option value="">Select One </option>')

                                                if (!!id) {
                                                    let selected = considerAttemptApp.considerAttemptList.filter(item => item.attemptName == id ? true : false);
                                                    if (selected[0].considerContact != null) $('#considet_contact_id').append('<option value="'+selected[0].considerContact+'" selected="selected">'+selected[0].considerContact+'</option>');
                                                    if (selected[0].considerContact != null){
                                                        $('#ptp_contact_details_id,#ptp_contact_details_id_single').append('<option value="'+selected[0].id+'" selected="selected">'+selected[0].considerContact+'</option>');
                                                        $('#ptp_contact_details').val(selected[0].considerContact)
                                                    }
                                                    if (selected[0].contactCategory != null) $('#contact_category_id').append('<option value="'+selected[0].contactCategory+'" selected="selected">'+selected[0].contactCategory+'</option>');
                                                    if (selected[0].contactCategory != null){
                                                        $('#ptp_promisor_details_id').append('<option value="'+selected[0].id+'" selected="selected">'+selected[0].contactCategory+'</option>');
                                                        $('#ptp_promisor_details').val(selected[0].contactCategory)
                                                    }
                                                }
                                            })
                                        })

                                    </script>


                                    <div class="csi-view-form-full-area csi-view-indtable col-sm-6">
                                        <div class="box-header with-border csi-view-box-header">
                                            <label class="box-title" >Follow Up  </label>
                                        </div>
                                        <div class="box-body" >
                                            <form id="followUpSaveForm" action="" method="post" class="form-horizontal">
                                                <input type="hidden" name="_csrf"/>
                                                <input type="hidden" th:value="${loanprofileview.id}" name="customerBasicInfo.id"/>
                                                <div class="form-group">
                                                    <label class="col-sm-2 custom-details-lebel-left">Choose Date</label>
                                                    <div class="col-sm-4">
                                                        <div class="input-group date">
                                                            <div class="input-group-addon">
                                                                <i class="fa fa-calendar"></i>
                                                            </div>
                                                            <input type="text" name="followUpDates" class="form-control fu-date follow-up-date-loan"
                                                                   placeholder="dd-mm-yyyy" />
                                                        </div>
                                                    </div>
                                                    <label class="col-sm-2 custom-details-lebel-left">Choose Time</label>
                                                    <div class="col-sm-4">
                                                        <div class="input-group date">
                                                            <input type="time" class="form-control " name="followUpTime" >
                                                        </div>
                                                    </div>
                                                </div>


                                                <div class="form-group">
                                                    <label for="checkbox" class="col-sm-2 control-label">Activity</label>

                                                    <div class="col-sm-10">
                                                        <div class="checkbox">
                                                            <label class="col-sm-2">
                                                                <input class="ads_Checkbox " type="checkbox" id="checkbox" value="Call">
                                                                Call
                                                            </label>
                                                            <label class="col-sm-2">
                                                                <input class="ads_Checkbox " type="checkbox" id="checkbox1" value="SMS">
                                                                SMS
                                                            </label>
                                                            <label class="col-sm-2">
                                                                <input class="ads_Checkbox " type="checkbox" id="checkbox2" value="Email">
                                                                Email
                                                            </label>
                                                            <label class="col-sm-2">
                                                                <input class="ads_Checkbox " type="checkbox" id="checkbox3" value="Letter">
                                                                Letter
                                                            </label>
                                                            <label class="col-sm-2">
                                                                <input class="ads_Checkbox " type="checkbox" id="checkbox4" value="Visit">
                                                                Visit
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div style="border:inherit">

                                        </div>
                                        <div class="box-body" >
                                            <div class="box-header with-border csi-view-box-header">
                                                <label class="box-title" >Reason For Delinquency</label>
                                            </div>
                                            <form id="reasonForDelinquencyForm" action="" method="post" class="form-horizontal">
                                                <input type="hidden"  th:value="${loanprofileview.id}"
                                                       name="customerBasicInfoEntity"/>
                                                <input type="hidden" name="accountNo">
                                                <input type="hidden" name="_csrf"/>
                                                <div >
                                                    <!-- select -->
                                                    <div class="form-group">
                                                        <br>
                                                        <label class="col-sm-4 control-label">Reason For Delinquency :</label>
                                                        <div class="col-sm-8">
                                                            <select name="reaDelinName" id="select-reason-delinquency" class="form-control reason-delinquency-loan">

                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>


                                    <!--ptp create form modal-->

                                </div>
                            </div>

                            <script>

                                var date = new Date();
                                $('.datepickerPTP').datepicker({
                                    startDate: date,
                                    format: 'yyyy-mm-dd',
                                    autoclose: true,
                                    forceParse: false
                                });
                                var ptp = new Vue({
                                    el: '#loan_ptpForm',
                                    data: {
                                        date: '',
                                        customerLocationAutoSelect: '',
                                        disabledDates: {
                                            to: new Date(Date.now() - 8640000)
                                        },
                                    },
                                    components: {
                                        vuejsDatepicker
                                    },
                                    computed: {
                                        getDate() {
                                            if(this.date != '' && this.date != null){
                                                return (this.date.getMonth() + 1) + "-" + this.date.getDate() + "-" + this.date.getFullYear();
                                            }else{
                                                return '';
                                            }
                                        },
                                        ptpEmptyCheck(){
                                            //console.log("loan amount : "+$("#loan_amount").val());
                                        }
                                    },
                                });

                                function contactDetails() {
                                    var txtValue = $('select#ptp_contact_details_id option:selected').text();
                                    var value = $('select#ptp_contact_details_id option:selected').val();
                                    if(value != null && value != ''){
                                        $("#ptp_contact_details").val(txtValue);
                                    }else {
                                        $("#ptp_contact_details").val('');
                                    }
                                }

                                function contactLocation() {
                                    var txtValue = $('select#ptp_location_details_id option:selected').text();
                                    var value = $('select#ptp_location_details_id option:selected').val();
                                    if(value != null && value != ''){
                                        $("#ptp_location_details").val(txtValue);
                                    }else {
                                        $("#ptp_location_details").val('');
                                    }
                                }

                                function promisorDetails() {
                                    var txtValue = $('select#ptp_promisor_details_id option:selected').text();
                                    var value = $('select#ptp_promisor_details_id option:selected').val();
                                    if(value != null && value != ''){
                                        $("#ptp_promisor_details").val(txtValue);
                                    }else {
                                        $("#ptp_promisor_details").val('');
                                    }
                                }
                            </script>

                            <div class="box-primary col-sm-12" >
                                <div class="csi-view-form-full-area csi-view-indtable col-sm-6" style="padding: 14px; !important;">
                                    <div class="box-header with-border csi-view-box-header">
                                        <label class="box-title" >PTP</label>
                                    </div>
                                    <br>
                                    <div class="box-body" >
                                        <form id="loan_ptpForm" action="" method="post" class="form-horizontal">
                                            <input type="hidden" id="loanptpcustomerId" th:value="${loanprofileview.id}"
                                                   name="customerBasicInfo.id"/>
                                            <div >
                                                <input type="hidden" name="loan_contact_details" id="ptp_contact_details" value=""/>
                                                <input type="hidden" name="loan_contact_location" id="ptp_location_details" value=""/>
                                                <input type="hidden" name="loan_promisor_details" id="ptp_promisor_details" value=""/>
                                                <input type="hidden" name="id" id="id" value=""/>
                                                <input type="hidden" name="loan_ptp_dates" v-model="getDate"/>
                                                <!-- select -->
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">PTP Amount </label>
                                                    <div class="col-sm-4">
                                                        <input type="number" class="form-control ptp-amount-loan" id="loan_amount" name="loan_amount" v-on:change="ptpEmptyCheck"
                                                               placeholder="PTP Amount">
                                                    </div>
                                                    <label class="col-sm-2 control-label">Contact Details</label>
                                                    <div class="col-sm-4">
                                                        <select id="ptp_contact_details_id" name="loan_contact_details_id"
                                                                class="form-control" required='required' onchange="contactDetails()" disabled>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- select -->
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">Contact Location</label>
                                                    <div class="col-sm-4">
                                                        <input type="text"  name="contactLoacation" v-model="customerLocationAutoSelect" class="form-control" disabled/>
                                                    </div>
                                                    <label class="col-sm-2 control-label">Promisor Details</label>
                                                    <div class="col-sm-4">
                                                        <select id="ptp_promisor_details_id" name="loan_promisor_details_id"
                                                                class="form-control" required='required' onchange="promisorDetails()" disabled>
                                                        </select>
                                                    </div>
                                                </div>
                                                <!-- select -->
                                                <div class="form-group">
                                                    <label class="col-sm-2 control-label">Date</label>
                                                    <div class="col-sm-4">
                                                        <div class="input-group date">
                                                            <div class="input-group-addon">
                                                                <i class="fa fa-calendar"></i>
                                                            </div>
                                                            <input type="date" name="loan_ptp_date" class="form-control pull-right ptp-date-loan" id="loan_ptp_date">
                                                        </div>
                                                    </div>
                                                    <label for="card_ptp_time" class="col-sm-2 control-label">Time</label>
                                                    <div class="col-sm-4">
                                                        <div class="input-group">
                                                            <div class="input-group-addon">
                                                                <i class="fa fa-clock-o"></i>
                                                            </div>
                                                            <input type="time" name="loan_ptp_time" class="form-control"
                                                                   id="card_ptp_time" placeholder="12:00 PM"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <br>
                                    </div>
                                </div>


                                <div class="csi-view-form-full-area csi-view-indtable col-sm-6">
                                    <div class="box-header with-border csi-view-box-header">
                                        <label class="box-title" >Note Details</label>
                                    </div>
                                    <div class="box-body" >
                                        <form id="dailyNoteSaveForm" action="" method="post" class="form-horizontal">
                                            <!--TODO: include memo note category here-->
                                            <input type="hidden" th:value="${loanprofileview.id}" name="customerBasicInfo.id"/>
                                            <input type="hidden" name="accountNo"/>

                                            <div >
                                                <br>
                                                <!-- <label>Enter Details Here</label>-->
                                                <textarea class="form-control note-details-loan" rows="9" style="resize: none"
                                                          placeholder="Enter Details Here" name="note"></textarea>
                                            </div>
                                        </form>

                                    </div>
                                </div>

                            </div>



                            <script>

                               async function saveAllActivityTakenLoan(){
                                    var considarationMessage = "";
                                    var followUpdateMessage = "";
                                    var resonForDelquencyMesg = "";
                                    var ptpMesg = "";
                                    var noteDetailsMesg = "";
                                    if($('.consider-attempt-loan').val()!=''){
                                       // var returnData= contactSave();
                                        var returnData = Promise.resolve(contactSave());
                                        await returnData.then(function (v) {
                                            considarationMessage = v;
                                        });

                                    }
                                    if($('.follow-up-date-loan').val()!=''){
                                        var returnData = Promise.resolve(followUpSave());
                                        await returnData.then(function (v) {
                                            followUpdateMessage = v;
                                        });
                                        // followUpSave();

                                    }
                                    if($('.reason-delinquency-loan').val()!=''){
                                        var returnData = Promise.resolve(saveReasonForDelinquency());
                                        await returnData.then(function (v) {
                                            resonForDelquencyMesg = v;
                                        })
                                        // saveReasonForDelinquency();

                                    }
                                   // if ((!($('.ptp-amount-loan').val() >= 0) || !($('.ptp-amount-loan').val() < 0))&&( $('.ptp-date-loan').val()!=null || $('.ptp-date-loan').val()!='')){
                                    if($('.ptp-amount-loan').val()!='' && $('.ptp-date-loan').val()!=''){
                                        var returnData = Promise.resolve(save_loan_ptp());
                                        await returnData.then(function (v) {
                                            ptpMesg = v;
                                        })
                                        // save_loan_ptp();

                                    }

                                    if($('.note-details-loan').val()!=''){
                                        var returnData = Promise.resolve(dailyNoteSaveLoan());
                                        await returnData.then(function (v) {
                                            noteDetailsMesg = v;
                                        })
                                         // dailyNoteSave();

                                    }

                                   if (considarationMessage === true || followUpdateMessage === true || resonForDelquencyMesg === true || ptpMesg === true || noteDetailsMesg === true) {
                                       alert("Successfully saved !!");
                                       $("#modal-follow-up").hide();

                                   }

                                }
                                $(document).ready(function () {

                                    $('#reasonForDelinquencyForm input[name="_csrf"]').val(csrfToken);
                                    $('#reasonForDelinquencyForm input[name="accountNo"]').val(accountNo);


                                    function getMemoNote() {

                                        $.ajax({
                                            url: '/collection/dnote_menu/find-list',
                                            success: function (response) {
                                                var opt = [];
                                                opt.push('<option value="">'+'Select One'+'</option>');
                                                for (var i = 0; i< response.length; i++){
                                                    opt.push('<option value="'+response[i].name+'">'+response[i].name+'</option>');
                                                }
                                                $('#select-reason-delinquency').append($(opt.join('')));
                                            },
                                            error: function (response) {
                                                alert('Unsuccessful');
                                            }
                                        })
                                    }
                                    getMemoNote();
                                  })
                               async function saveReasonForDelinquency() {

                                  var  booleanMesg=false;
                                    var formValue = $("#reasonForDelinquencyForm").serialize();
                                    var token = $("meta[name='_csrf']").attr("content");
                                    var header = $("meta[name='_csrf_header']").attr("content");

                                await $.ajax({
                                        type:"post",
                                        url:"/collection/reason-delinquency/save",
                                        beforeSend: function (xhr) {
                                            xhr.setRequestHeader(header, token);
                                        },
                                        data:formValue,
                                        success:function (data) {
                                            booleanMesg=true;
                                            $('#select-reason-delinquency').val('');
                                            getReasonDelinquency(customerId);
                                        }
                                    })
                                   return booleanMesg;
                                }
                            </script>
                            <div class="box-footer">
                                <div style="text-align: center">
                                    <button type="button" class="btn btn-danger btn-sm pull-right" data-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary btn-sm pull-right" onclick="saveAllActivityTakenLoan()">Save</button>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
            <input class="gen-card-id" type="hidden" name="cardId" th:value="${cdi}"/>
            <input type="hidden" name="refId" id="refId" th:value="${refId}"/>

            <table name="reference_info" id="referenceinfo" class=" table table-striped table-bordered" style="max-height: 150px; overflow-y: auto;">
                <thead>
                <tr>
                    <th>Creator</th>
                    <th>Followup Date</th>
                    <th>Activity</th>
                </tr>
                </thead>
                <tbody id="followup_tBody">
                <tr v-for="followup in followUpList">
                    <td :title="followup.username+'-'+(followup.pin)+'/'+customDateFormat(followup.createdDate)">{{followup.username}}-({{followup.pin}})</td>
                    <td>{{followup.followUpDate | dateFormat}} / {{followup.followUpTime}}</td>
                    <td>
                        <span v-for="reason in followup.followUpReason" class="btn btn-sm">
                            {{reason.followUpReason}}
                        </span>
                    </td>
                    <td>
                        <a style="margin-left:2px" class="btn btn-xs btn-info" @click="viewFollowUp(followup.id)" data-toggle="modal" data-target="#modal-followUp-view"> <i class="fa fa-eye"></i></a>
                    </td>
                </tr>
                </tbody>
                <script>
                    var followUp = new Vue({
                        el: '#followup_tBody',
                        data: {
                            followUpList: [],
                        },
                        filters: {
                            dateFormat: function (value) {
                                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                ];
                                if (value) {
                                    var date = new Date(value);
                                    var day = date.getDate();
                                    if (day < 10) day = '0' + day;
                                    var hours = date.getHours();
                                    var minutes = date.getMinutes();
                                    var newFormat = hours >= 12 ? "PM" : "AM";
                                    hours = hours % 12;
                                    hours = hours ? hours : 12;
                                    minutes = minutes < 10 ? '0' + minutes : minutes;
                                    return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() ;//+ ' / ' + hours + ':' + minutes + ' ' + newFormat
                                } else {
                                    return "";
                                }
                            }
                        },
                        created: function () {
                            var host = window.location.host;
                            var url = 'https://' + host + '/customerloanprofile/followup/list?id=' + customerId;
                            this.$http.get(url,
                                {
                                    credentials: true, headers: {
                                        'X-CSRF-TOKEN': window.csrfToken,
                                    }
                                }).then(res => {
                                if (res.body) {
                                    this.followUpList = res.body;
                                }
                            }).catch(err => {
                                console.log(err);
                            })
                        },
                        methods: {
                            updateFollowupList: function (list) {
                                this.followUpList = list;
                            },
                            customDateFormat(value){
                                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                                ];
                                if (value) {
                                    var date = new Date(value);
                                    var day = date.getDate();
                                    if (day < 10) day = '0' + day;
                                    var hours = date.getHours();
                                    var minutes = date.getMinutes();
                                    var newFormat = hours >= 12 ? "PM" : "AM";
                                    hours = hours % 12;
                                    hours = hours ? hours : 12;
                                    minutes = minutes < 10 ? '0' + minutes : minutes;
                                    return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                                } else {
                                    return "";
                                }
                            },
                            viewFollowUp: function (id) {
                                $.ajax({
                                    url: '/customerloanprofile/followup/ById?id=' + id,
                                    success: function (response) {
                                        $("#followUpDate").text(formatDate_DD_MMM_YYYY(response.followUpEntity.followUpDate));
                                        $("#followUpTime").text(response.followUpEntity.followUpTime);
                                        $("#followUpRemarks").text(response.followUpEntity.followUpRemarks);
                                        $('#followUpReason').text("");
                                        $(response.followUpEntity.followUpReason).each(function(i){
                                            if(i>0 && i<response.followUpEntity.followUpReason.length)
                                                $('#followUpReason').append(",");
                                            $('#followUpReason').append(response.followUpEntity.followUpReason[i]);
                                        })
                                    },
                                    error: function (response) {
                                        alert('Unsuccessful');
                                    }
                                })
                            }
                        }

                    })
                </script>
            </table>
        </div>

        <div class="modal fade" id="modal-followUp-view">
            <div class="modal-dialog modal-md">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" style="text-align: center">Follow Up</h4>
                    </div>
                    <div class="modal-body form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Follow Up Date</label>
                            <label class="col-sm-4 custom-form-lebel"  id="followUpDate"></label>
                            <label class="col-sm-2 control-label">Follow Up Time</label>
                            <label class="col-sm-4 custom-form-lebel"  id="followUpTime" style="word-break: break-word;"></label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Follow Up Reason</label>
                            <label class="col-sm-4 custom-form-lebel"  id="followUpReason"></label>
                            <label class="col-sm-2 control-label">Follow Up Remarks</label>
                            <label class="col-sm-4 custom-form-lebel"  id="followUpRemarks"></label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal" >Close</button>
                    </div>

                </div>
            </div>
        </div>

        <script type="text/javascript" th:src="@{/customerprofileloan/followup.js}"></script>
    </div>

    <div class="box box-primary">
        <style>
            .vdp-datepicker input {
                width: 100%;
                padding: 7px;
                border: 1px solid #f1f1f1;
                border-color: #d2d6de;
            }
        </style>
        <div class="box-header with-border">
            <h3 class="box-title">PTP</h3>
        </div>
        <div class="box-body">
            <div class="form-horizontal csi-view-form" id="ptp" style=" max-height: 150px; overflow-y: auto;">
                <table name="ptp_info" id="ptpinfo"
                       class=" table table-hover table-bordered">
                    <thead>
                    <tr>
                        <th>Creator</th>
                        <th>PTP Amount</th>
                        <th>Contact Details</th>
                        <th style="min-width: 90px">PTP Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody id="ptptBody">

                    </tbody>
                </table>

            </div>
            <script th:inline="javascript">
                /*<![CDATA[*/
                var user_designation = /*[[${session.userDesignation}]]*/ [];
                var userRole = /*[[${session.userRole}]]*/ [];

                /*]]>*/
            </script>
            <script>
                var ptpinfo = new Vue({
                    el: '#ptpinfo',
                    data: {
                        ptpList: [],
                    },
                    filters: {
                        dateFormat: function (value) {
                            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                            ];
                            if (value != '') {
                                var date = new Date(value);
                                var day = date.getDate();
                                if (day < 10) day = '0' + day;
                                var hours = date.getHours();
                                var minutes = date.getMinutes();
                                var newFormat = hours >= 12 ? "PM" : "AM";
                                hours = hours % 12;
                                hours = hours ? hours : 12;
                                minutes = minutes < 10 ? '0' + minutes : minutes;
                                return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                            } else {
                                return "";
                            }
                        }
                    },
                    created: function () {
                        var host = window.location.host;
                        var url = 'https://' + host + '/collection/loan/ptp/list?id=' + customerId;
                        this.$http.get(url,
                            {
                                credentials: true, headers: {
                                    'X-CSRF-TOKEN': window.csrfToken,
                                }
                            }).then(res => {
                            if (res.body) {
                                this.ptpList = res.body;
                                this.showDataInTheTable(res.body);
                            }
                        }).catch(err => {
                            console.log(err);
                        })
                    },
                    methods: {
                        dateFormat: function (value) {
                            var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                                "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                            ];
                            if (value != '') {
                                var date = new Date(value);
                                var day = date.getDate();
                                if (day < 10) day = '0' + day;
                                var hours = date.getHours();
                                var minutes = date.getMinutes();
                                var newFormat = hours >= 12 ? "PM" : "AM";
                                hours = hours % 12;
                                hours = hours ? hours : 12;
                                minutes = minutes < 10 ? '0' + minutes : minutes;
                                return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                            } else {
                                return "";
                            }
                        },
                        updateTheList: function () {
                            var host = window.location.host;
                            var url = 'https://' + host + '/collection/loan/ptp/list?id=' + customerId;
                            this.$http.get(url,
                                {
                                    credentials: true, headers: {
                                        'X-CSRF-TOKEN': window.csrfToken,
                                    }
                                }).then(res => {
                                if (res.body) {
                                    this.ptpList = res.body;
                                    this.showDataInTheTable(res.body);
                                }
                            }).catch(err => {
                                console.log(err);
                            })
                        },
                        showDataInTheTable: function (data) {

                            $('#ptptBody').replaceWith("<tbody id=\"ptptBody\" >\n" + "\t\t\t\t\t\t\t</tbody>");

                            for (var i = 0; i < data.length; i++) {
                                if (data != null) {

                                    let date = new Date(data[i].loan_ptp_date);
                                    date.setHours(0);
                                    date.setMinutes(0);
                                    date.setSeconds(0);

                                    let date1 = new Date();
                                    date1.setHours(0);
                                    date1.setMinutes(0);
                                    date1.setSeconds(0);

                                    var str1 = '';
                                    var str2 = '';
                                    var str3 = '';
                                    let b = date >= date1;
                                    if (b) {
                                        if(user_designation =='Dealer') {
                                            str1 = "<a style=\"margin-left:2px\" class=\"btn btn-xs btn-info\" onclick=\"loan_ptp_editRow(this," + data[i].loan_contact_details_id + "," + data[i].loan_contact_location_id + "," + data[i].loan_promisor_details_id + ",)\"> <i class=\"fa fa-edit\"></i></a>"
                                        }
                                    }
                                    str3 = "<a style=\"margin-left:2px\" class=\"btn btn-xs btn-info\" onclick=\"loan_ptp_viewRow(this)\"> <i class=\"fa fa-eye\"></i></a>";
                                    data[i].createdDate = this.dateFormat(data[i].createdDate);

                                    var str = "<tr>" +
                                        "<td style=\"display:none;\">" + data[i].id + "</td>" +
                                        "<td>" + data[i].username + "-(" + data[i].pin + " )"+"</td>" +
                                        "<td class='text-right'>" + numberToBDTFormat(data[i].loan_amount) + "</td>" +
                                         "<td>" + (data[i].loan_contact_details == null ? '' : data[i].loan_contact_details) + "</td>" +

                                        "<td>" + (data[i].loan_ptp_date != null ? formatDate_DD_MMM_YYYY(data[i].loan_ptp_date) : '') + "</td>" +

                                        "<td> " + data[i].loan_ptp_status + "</td>" +
                                        "<td>" + str2 + str1 + str3 + "</td>" +
                                        "<td style=\"display:none;\">" + data[i].username + "- (" + data[i].pin + ")/ " + data[i].createdDate + "</td>" +
                                        "</tr>";
                                    $('#ptptBody').append(str);
                                }
                            }
                        }
                    }
                })
            </script>
        </div>

        <div class="modal fade in" id="modal-ptp-data-create">
            <div class="modal-dialog modal-lg">
                <div id="loan_ptp_form_single" class="modal-content" style="border-radius: 9px">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" style="text-align: center">PTP</h4>
                    </div>
                    <form id="loan_ptpForm_update"  action="" method="post" class="form-horizontal">
                        <input type="hidden" id="loanptpcustomerId_single" th:value="${loanprofileview.id}"
                               name="customerBasicInfo.id"/>
                        <div class="modal-body">
                            <input type="hidden" name="loan_contact_details" id="ptp_contact_details_single" value=""/>
                            <input type="hidden" name="loan_contact_location" id="ptp_location_details_single" value=""/>
                            <input type="hidden" name="loan_promisor_details" id="ptp_promisor_details_single" value=""/>
                            <input type="hidden" name="id" id="id_single" value=""/>
                            <input type="hidden" name="loan_ptp_dates" id="loan_ptp_date_update" v-model="getDate"/>
                            <!-- select -->
                            <div class="form-group">
                                <label class="col-sm-2 control-label">PTP Amount </label>
                                <div class="col-sm-4">
                                    <input type="number" class="form-control" id="loan_amount_single" name="loan_amount"
                                           placeholder="PTP Amount">
                                </div>
                                <label class="col-sm-2 control-label">Contact Details</label>
                                <div class="col-sm-4">
                                    <select id="ptp_contact_details_id_single" name="loan_contact_details_id"
                                            class="form-control" required='required' onchange="contactDetailsForUpdate()">
                                    </select>
                                </div>
                            </div>
                            <!-- select -->
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Contact Location</label>
                                <div class="col-sm-4">
                                    <select id="ptp_location_details_id_single" name="loan_contact_location_id"
                                            class="form-control" required='required' onchange="contactLocationForUpdate()">
                                    </select>
                                </div>
                                <label class="col-sm-2 control-label">Promisor Details</label>
                                <div class="col-sm-4">
                                    <select id="ptp_promisor_details_id_single" name="loan_promisor_details_id"
                                            class="form-control" required='required' onchange="promisorDetailsForUpdate()">
                                    </select>
                                </div>
                            </div>
                            <!-- select -->
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Date</label>
                                <div class="col-sm-4">
                                    <div class="input-group date">
                                        <div class="input-group-addon">
                                            <i class="fa fa-calendar"></i>
                                        </div>
                                        <input type="date" name="loan_ptp_date" class="form-control pull-right" id="loan_ptp_date_single">
                                    </div>
                                </div>
                                <label for="card_ptp_time" class="col-sm-2 control-label">Time</label>
                                <div class="col-sm-4">
                                    <div class="input-group">
                                        <div class="input-group-addon">
                                            <i class="fa fa-clock-o"></i>
                                        </div>
                                        <input type="time" name="loan_ptp_time" class="form-control"
                                               id="card_ptp_time_single" placeholder="12:00 PM"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="loan_ptp_btn_single" data-dismiss="modal"
                                onclick="clearformdisable()">Close
                        </button>
                        <button type="submit" id="loan_ptp_save_btn_single" class="btn btn-primary" onclick="update_loan_ptp()">
                            Save
                        </button>
                    </div>
                </div>
                <script>
                    var ptp = new Vue({
                        el: '#loan_ptp_form_single',
                        data: {
                            date: '',
                            disabledDates: {
                                to: new Date(Date.now() - 8640000)
                            },
                        },
                        components: {
                            vuejsDatepicker
                        },
                        computed: {
                            getDate() {
                                if(this.date != '' && this.date != null){
                                    return (this.date.getMonth() + 1) + "-" + this.date.getDate() + "-" + this.date.getFullYear();
                                }else{
                                    return '';
                                }
                            }
                        },
                    });

                    function contactDetailsForUpdate() {
                        var txtValue = $('select#ptp_contact_details_id_single option:selected').text();
                        var value = $('select#ptp_contact_details_id_single option:selected').val();
                        if(value != null && value != ''){
                            $("#ptp_contact_details_single").val(txtValue);
                        }else {
                            $("#ptp_contact_details_single").val('');
                        }
                    }

                    function contactLocationForUpdate() {
                        var txtValue = $('select#ptp_location_details_id_single option:selected').text();
                        var value = $('select#ptp_location_details_id_single option:selected').val();
                        if(value != null && value != ''){
                            $("#ptp_location_details_single").val(txtValue);
                        }else {
                            $("#ptp_location_details_single").val('');
                        }
                    }

                    function promisorDetailsForUpdate() {
                        var txtValue = $('select#ptp_promisor_details_id_single option:selected').text();
                        var value = $('select#ptp_promisor_details_id_single').val();
                        if(value != null && value != ''){
                            $("#ptp_promisor_details_single").val(txtValue);
                        }else {
                            $("#ptp_promisor_details_single").val('');
                        }
                    }
                </script>
            </div>
        </div>

        <div class="modal fade" id="modal-ptp-view">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" style="text-align: center">PTP</h4>
                    </div>
                    <form id="loan_ptpForm-view" action="" method="get" class="form-horizontal">
                        <div class="modal-body">
                            <!-- select -->
                            <div class="row top-buffer">
                                <label class="col-sm-2 custom-details-lebel-left"> Amount :</label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_ptp_amount_view"></label>
                                <label class="col-sm-2 custom-details-lebel-left">Contact Details :</label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_ptp_contact_view"></label>
                            </div>
                            <!-- select -->
                            <div class="row top-buffer">
                                <label class="col-sm-2 custom-details-lebel-left"> Contact Location : </label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_contact_location_view"></label>
                                <label class="col-sm-2 custom-details-lebel-left">Promisor Details :</label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_ptp_promisor_view"></label>
                            </div>
                            <!-- select -->

                            <div class="row top-buffer">
                                <label class="col-sm-2 custom-details-lebel-left"> Date : </label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_ptp_date_view"></label>
                                <label class="col-sm-2 custom-details-lebel-left">Time : </label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_ptp_time_view"></label>
                            </div>


                            <div class="row top-buffer">
                                <label class="col-sm-2 custom-details-lebel-left"> Creator : </label>
                                <label class="col-sm-4 custom-form-lebel" id="loan_ptp_creator_view"></label>
                            </div>

                        </div>
                    </form>

                    <div class="modal-footer text-center">
                        <button type="button" class="btn btn-danger" id="loan_ptp_btn" data-dismiss="modal"
                                onclick="clearformdisable()">Close
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="box box-primary">
        <div class="box-header with-border">
            <h2 class="box-title" style="margin-top: 10px;">Document Upload</h2>
            <a class=" btn btn-xs btn-primary pull-right" data-toggle="modal"
               data-target="#modal-document-upload-form">
                <i class="fa fa-plus-square"></i>
                Add More
            </a>
        </div>
        <div class="box-body" id="recommendation">
            <div class="row">
                <div class="col-md-12">
                    <div style="max-height: 18em; overflow: auto;">
                        <table id="dms"
                               class=" table table-striped table-bordered">
                            <thead>
                            <tr>
                                <th style="text-align: center">File Name</th>
                                <th>Uploaded By</th>
                                <th>Uploaded on</th>
                                <th style="text-align: center">Comment</th>
                                <th style="text-align: center">Action</th>
                            </tr>
                            </thead>
                            <tbody id="dms_table">
                            <tr v-for="document in documentUpload">

                                <td style="text-align: center">{{document.name}}</td>
                                <td>{{document.pin}}-{{document.creatorName}}</td>
                                <td>{{document.createdDate | dateFormat}}</td>
                                <td style="text-align: center">{{document.comments}}</td>
                                <td style="text-align: center">
                                    <a class="btn btn-success btn-xs" target="_blank" title="Preview"
                                       :href="'/collection/dms/document/preview?id=' + document.dmsId + '&type=' + document.type">
                                        <i class="fa fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
            <div class="modal modal-lg fade" id="modal-document-preview-from-server">
                <div class="modal-dialog">
                    <div class="modal-content" style="border-radius: 5px;">
                        <div class="modal-body">
                            <table>
                                <thead>

                                </thead>
                                <tbody>
                                <tr>
                                    <td>
                                        <input th:id="uploadFileIdPreview" :value="documentProperty.id" type="hidden"/>
                                        <input th:id="docurlPreview" :value="documentProperty.url" type="hidden"/>
                                        <input th:id="doctypePreview" :value="documentProperty.type" type="hidden"/>
                                        <a href="#" onclick="showReportPreview(document.getElementById('uploadFileIdPreview').value,document.getElementById('doctypePreview').value);
                                                                     showReportPreview2(document.getElementById('uploadFileIdPreview').value,document.getElementById('doctypePreview').value);">
                                            <span text="" id="docnamePreview">{{documentProperty.name}}</span>
                                        </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <iframe id="showPreviewReport" width="900" height="510" frameborder="0"
                                    allowfullscreen="allowfullscreen"></iframe>
                        </div>
                    </div>
                </div>
            </div>
            <!--Document upload form-->
            <div class="modal fade" id="modal-document-upload-form">
                <div class="modal-dialog">
                    <div class="modal-content" style="border-radius: 5px;">
                        <div class="modal-header">
                            <button type="button" class="close bg-danger" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" style="text-align: center;">Upload Document</h4>
                        </div>
                        <form id="managerRecommendation" action="" method="post" class="form-horizontal">
                            <input type="hidden" th:value="${loanprofileview.id}" name="customerBasicInfo.id"/>
                            <div class="modal-body">
                                <input type="hidden" id="manager_rec_id" name="id" value=""/>
                                <div class="form-group" id="manager_comment_input">
                                    <label class="col-sm-2 custom-details-lebel-left">Comments</label>
                                    <div class="col-sm-10">
                                        <textarea maxlength="255" v-model="comments" class="form-control" rows="3"
                                                  placeholder="Commnet"
                                                  id="manager_comment" name="branchComment"></textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 custom-details-lebel-left">Upload File.</label>
                                    <div class="fileUpload btn-upload-img col-sm-3">
                                        <input type="file" class="custom-form-control upload ufile" id="mfile_200_0"
                                               onchange="mangerfile_preview('200',0);"/>
                                    </div>
                                    <div class="col-sm-12">
                                        <label class="col-sm-offset-2 col-sm-8 text-danger"
                                               id="file-validation-message"></label>
                                    </div>

                                </div>
                                <div class="form-group">
                                    <div class="col-sm-10 col-sm-offset-2" id="td_200_0" style="position: relative">

                                    </div>
                                </div>

                                <div id="idivpreview" class="col-sm-6" style="display:none;">
                                    <iframe id="iframeMangerCommnet" style="height:270px; width:350px"></iframe>
                                </div>
                            </div>

                            <div class="modal-footer text-center">
                                <button :disabled="disabledSaveButton" style="float: right"
                                        id="manager_commentbtn_commit" @click.prevent="uploadDocument"
                                        class="btn btn-info">Save
                                </button>
                                <button style="float:left" type="button" onclick="commnetFormClear();"
                                        class="btn btn-danger" data-dismiss="modal">Close
                                </button>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            /*<![CDATA[*/
            var customerId = /*[[${loanprofileview.id}]]*/ [];

            /*]]>*/
        </script>
        <script>
            var dmsApp = new Vue({
                el: '#recommendation',
                data: {
                    comments: "",
                    documentUpload: [],
                    documentProperty: {},
                    disabledSaveButton: false,
                },
                created: function () {
                    var host = window.location.host;
                    var url = 'https://' + host + '/collection/dms/document/list?id=' + customerId;
                    this.$http.get(url,
                        {
                            credentials: true, headers: {
                                'X-CSRF-TOKEN': window.csrfToken,
                            }
                        }).then(res => {
                        if (typeof res.body !== 'string') {
                            this.documentUpload = res.body;

                        }
                    }).catch(err => {
                        console.log(err);
                    })
                },
                filters: {
                    dateFormat: function (value) {
                        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                            "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                        ];
                        if (value != '') {
                            var date = new Date(value);
                            var day = date.getDate();
                            if (day < 10) day = '0' + day;
                            var hours = date.getHours();
                            var minutes = date.getMinutes();
                            var newFormat = hours >= 12 ? "PM" : "AM";
                            hours = hours % 12;
                            hours = hours ? hours : 12;
                            minutes = minutes < 10 ? '0' + minutes : minutes;
                            return day + '-' + monthNames[date.getMonth()] + '-' + date.getFullYear().toString() + ' / ' + hours + ':' + minutes + ' ' + newFormat;
                        } else {
                            return "";
                        }
                    }
                },
                methods: {
                    uploadDocument: function () {
                        var file = $("#mfile_200_0")[0].files[0];
                        let validationMessage = isValidFileUpload(file);
                        if (validationMessage !== 'valid') {
                            $('#file-validation-message').html(validationMessage);
                            return;
                        }

                        this.disabledSaveButton = true;
                        var comment = this.comments;
                        var customer = customerId;

                        let formData = new FormData();
                        formData.append('file', file);
                        formData.append('id', customer);
                        formData.append('comments', comment);

                        var host = window.location.host;
                        this.$http.post('https://' + host + '/collection/dms/document/upload', formData, {
                            credentials: true, headers: {
                                'X-CSRF-TOKEN': window.csrfToken,
                                'Content-Type': 'multipart/form-data'
                            }
                        }).then(res => {
                            $('#modal-document-upload-form').modal('hide');
                            this.disabledSaveButton = false;
                            if (typeof res.body !== 'string') {
                                this.documentUpload = res.body;
                                swal("Successfully Saved");
                            } else {
                                swal("Something went wrong");
                            }
                        }).catch(err => {
                            console.log(err);
                        })
                    },
                    showDocumentPreview: function (id, name, type) {
                        var host = window.location.host;
                        var url = 'https://' + host + '/collection/dms/document/view?id=' + id + '&name=' + name + '&type=' + type;
                        this.$http.get(url,
                            {
                                credentials: true, headers: {
                                    'X-CSRF-TOKEN': window.csrfToken,
                                }
                            }).then(res => {
                            if (typeof res.body !== 'string') {
                                this.documentProperty = res.body;
                            }
                        }).catch(err => {
                            console.log(err);
                        })
                    }

                }
            })
        </script>
    </div>
    <div class="box box-primary" id="loanComentBox">
        <div class="box-header with-border">
            <h3 class="box-title">Special Note</h3>
        </div>
        <div class="box-body" style="max-height: 400px;min-height: 300px; overflow: auto;">
            <div class="direct-chat-messages" v-for="comment in comments">
                <!-- Message to the right -->
                <div v-if="userId === comment.senderId" class="direct-chat-msg right">
                    <div class="direct-chat-info clearfix">
                        <span class="direct-chat-name pull-left">{{comment.senderName}}</span>
                        <span class="direct-chat-timestamp pull-right">{{comment.time}}</span>
                    </div>
                    <!-- /.direct-chat-info -->
                    <!-- /.direct-chat-img -->
                    <div class="direct-chat-text">
                        {{comment.msg}}
                    </div>
                    <!-- /.direct-chat-text -->
                </div>
                <!-- /.direct-chat-msg -->


                <!-- Message. Default to the left -->
                <div v-else class="direct-chat-msg ">
                    <div class="direct-chat-info clearfix">
                        <span class="direct-chat-name pull-right">{{comment.senderName}}</span>
                        <span class="direct-chat-timestamp pull-left">{{comment.time}}</span>
                    </div>
                    <!-- /.direct-chat-info -->
                    <!-- /.direct-chat-img -->
                    <div class="direct-chat-text">
                        {{comment.msg}}
                    </div>
                    <!-- /.direct-chat-text -->
                </div>
                <!-- /.direct-chat-msg -->
            </div>
        </div>

        <div class="box-footer">
            <form action="#" method="post">
                <div class="input-group">
                    <input type="text" v-model="msg" placeholder="Type Message ..." class="form-control">
                    <span class="input-group-btn">
                        <button type="submit" @click.prevent="send" class="btn btn-primary btn-flat">Send</button>
                    </span>
                </div>
            </form>
        </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var customerId = /*[[${loanprofileview.id}]]*/ [];

        /*]]>*/

    </script>
    <script>
        var commentBox = new Vue({
            el: '#loanComentBox',
            data: {
                msg: '',
                comments: [],
                customerID: '',
                userId: '',
            },
            created: function () {
                this.customerID = customerId;
                var host = window.location.host;
                var url = 'https://' + host + '/collection/card/comment/list?id=' + this.customerID;
                this.$http.get(url,
                    {
                        credentials: true, headers: {
                            'X-CSRF-TOKEN': window.csrfToken,
                        }
                    }).then(res => {
                    if (res.body) {
                        var commentList = res.body.commentList;
                        var userList = res.body.userList;
                        this.userId = res.body.userId;

                        commentList.forEach((c, i) => {
                            var senderId = c.userId;
                            var senderName = userList[i];
                            var time = c.time;
                            var msg = c.msg;

                            this.comments.push({
                                senderId: senderId,
                                senderName: senderName,
                                time: time,
                                msg: msg,
                            });
                        });
                    }
                }).catch(err => {
                    console.log(err);
                })
            },
            methods: {
                send: function () {
                    var host = window.location.host;
                    this.$http.post('https://' + host + '/collection/card/comment/save', {
                        customerId: this.customerID,
                        comment: this.msg,

                    }, {
                        credentials: true, headers: {
                            'X-CSRF-TOKEN': window.csrfToken,
                        }
                    }).then(res => {

                        if (res.body) {
                            this.msg = '';
                            this.updateMsg();
                        }
                    }).catch(err => {
                        console.log(err);
                    })
                },
                updateMsg: function () {
                    // this.customerId = customerId;
                    var host = window.location.host;
                    var url = 'https://' + host + '/collection/card/comment/list?id=' + this.customerID;
                    this.$http.get(url,
                        {
                            credentials: true, headers: {
                                'X-CSRF-TOKEN': window.csrfToken,
                            }
                        }).then(res => {
                        if (res.body) {
                            var commentList = res.body.commentList;
                            var userList = res.body.userList;

                            this.comments = [];
                            commentList.forEach((c, i) => {
                                var senderId = c.userId;
                                var senderName = userList[i];
                                var time = c.time;
                                var msg = c.msg;

                                this.comments.push({
                                    senderId: senderId,
                                    senderName: senderName,
                                    time: time,
                                    msg: msg,
                                });
                            });
                        }
                    }).catch(err => {
                        console.log(err);
                    })
                }
            }
        });
    </script>
</div>
</body>
</html>