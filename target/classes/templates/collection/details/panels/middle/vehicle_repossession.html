<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="ISO-8859-1"></meta>
    <title>Vehicle Repossession</title>
</head>
<body>

<div id="layout-cibReport" th:fragment="vehicle-repossession">
    <div class="csi-view-form-full-area csi-view-indtable">
        <div class="box-header with-border csi-view-box-header">
            <h3 class="box-title">Vehicle Repossession</h3>
            <a id="add-vehicle-repossession" class=" btn btn-xs btn-primary pull-right" data-toggle="modal" data-target="#modal-vehicle-repossession" >
                <i class="fa fa-plus-square"></i>
                Add More
            </a>
        </div>

        <div class="box-body" id="vehicle-repossession-view-app">
            <div class="row">
                <div class="modal fade in" id="modal-vehicle-repossession"  data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 60%">
                        <div class="modal-content col-sm-12">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                </button>
                                <h3 >Vehicle Repossession</h3>
                            </div>
                            <form id="vehicleRepossessionForm" class="form-horizontal csi-view-form" method="post" enctype="multipart/form-data">
                                <input name="_csrf" value="" type="hidden">
                                <input id="customerId" name="customerId" type="hidden"/>
                                <input type="hidden" id="vehicleId" :value="vehicleRepossession.id" name="id"/>

                                <div class="alert alert-warning hidden" id="vehicle-error-messages"></div>

                                <div class="col-sm-12">
                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Type :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleType" type="text" name="vehicleType">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Model :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleModel" type="text" name="vehicleModel">
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Registration No :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleRegistrationNo" type="text" name="vehicleRegistrationNo">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Chassis No :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleChassisNo" type="text" name="vehicleChassisNo">
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Engine No :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleEngineNo" type="text" name="vehicleEngineNo">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Year of Manufacturing :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" id="yearpeacker" :value="formatDateInput(vehicleRepossession.yearManufacturing)" type="text" name="yearManufacturing">
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle CC :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleCC" type="text" name="vehicleCC">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left"> Present Status :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.presentStatus" type="text" name="presentStatus">
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Agency Handover Date :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="formatDateInput(vehicleRepossession.agencyHandOverDate)" type="date" name="agencyHandOverDate">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Repossession Date :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="formatDateInput(vehicleRepossession.repossessionDate)" type="date" name="repossessionDate">
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12">
                                        <!--<label class="col-sm-2 custom-details-lebel-left">CL Status on Repossession Date :</label>-->
                                        <!--<div class="col-sm-4">-->
                                            <!--<input class="form-control" :value="formatDateInput(vehicleRepossession.clStatusRepossessionDate)" type="date" name="clStatusRepossessionDate">-->
                                        <!--</div>-->
                                        <label class="col-sm-2 custom-details-lebel-left">CL Status :</label>
                                        <div class="col-sm-4">
                                            <select class="form-control" name="cLStatus" id="vehicle-cLStatusId">
                                                <option value="0">Select CL Status</option>
                                            </select>
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Release Date :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="formatDateInput(vehicleRepossession.vehicleReleaseDate)" type="date" name="vehicleReleaseDate">
                                        </div>
                                    </div>

                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Legal Handover Date :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="formatDateInput(vehicleRepossession.samHandoverDate)" type="date" name="samHandoverDate">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Auction Date :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="formatDateInput(vehicleRepossession.auctionDate)" type="date" name="auctionDate">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Agency Name :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.agencyName" type="text" name="agencyName">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Repossess By :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.repossessBy" type="text" name="repossessBy">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">Vehicle Colour :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.vehicleColour" type="text" name="vehicleColour">
                                        </div>
                                        <label class="col-sm-2 custom-details-lebel-left">Brand Name :</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" :value="vehicleRepossession.brandName" type="text" name="brandName">
                                        </div>
                                    </div>
                                    <div class="form-group col-sm-12">
                                        <label class="col-sm-2 custom-details-lebel-left">File :</label>
                                        <div class="col-sm-4">
                                        <input class="form-control" type="file" name="file">
                                        </div>
                                    </div>

                                    <div class="modal-footer text-center">
                                        <button type="submit" id="vehicle-repossession-save-button" class="btn btn-info">Save</button>
                                        <button type="button" id="cardRefModalCancelBtn" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="modal fade" id="modal-view-vehicle-repossession"  data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog" style="width: 60%">
                        <div class="modal-content col-sm-12">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <!--<span aria-hidden="true">×</span>-->
                                </button>
                                <h3 >Vehicle Repossession</h3>
                            </div>

                            <div class="box-body">
                                <div class="modal-footer text-center">
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left ">Vehicle Type :</label>
                                        <label  class="col-sm-3 custom-form-control" id="guarantorAccountNo">{{vehicleRepossession.vehicleType}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle Model :</label>
                                        <label class="col-sm-3 custom-form-control" id="guarantName">{{vehicleRepossession.vehicleModel}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle Registration No :</label>
                                        <label class="col-sm-3 custom-form-control" id="guarantorOccupation">{{vehicleRepossession.vehicleRegistrationNo}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle Chassis No :</label>
                                        <label class="col-sm-3 custom-form-control" id="guarantorCompanyName">{{vehicleRepossession.vehicleChassisNo}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle Engine No :</label>
                                        <label class="col-sm-3 custom-form-control"id="guarantorDesignation" >{{vehicleRepossession.vehicleEngineNo}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Year of Manufacturing :</label>
                                        <label class="col-sm-3 custom-form-control"id="guarantorHomeAddress">{{vehicleRepossession.yearManufacturing}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle CC :</label>
                                        <label class="col-sm-3 custom-form-control" id="guarantorOfficeAddress">{{vehicleRepossession.vehicleCC}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Present Status :</label>
                                        <label class="col-sm-3 custom-form-control" id="guarantorPermanentAddress">{{vehicleRepossession.presentStatus}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Agency Handover Date :</label>
                                        <label class="col-sm-3 custom-form-control" >{{formatDate(vehicleRepossession.agencyHandOverDate)}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Repossession Date :</label>
                                        <label class="col-sm-3 custom-form-control" >{{formatDate(vehicleRepossession.repossessionDate)}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">CL Status on Repossession Date :</label>
                                        <label class="col-sm-3 custom-form-control" >{{formatDate(vehicleRepossession.clStatusRepossessionDate)}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle Release Date :</label>
                                        <label class="col-sm-3 custom-form-control" >{{formatDate(vehicleRepossession.vehicleReleaseDate)}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Legal Handover Date :</label>
                                        <label class="col-sm-3 custom-form-control" id="guarantPhone">{{formatDate(vehicleRepossession.samHandoverDate)}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Auction Date :</label>
                                        <label class="col-sm-3 custom-form-control" >{{formatDate(vehicleRepossession.auctionDate)}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Agency Name :</label>
                                        <label class="col-sm-3 custom-form-control">{{vehicleRepossession.agencyName}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Repossess By :</label>
                                        <label class="col-sm-3 custom-form-control" >{{vehicleRepossession.repossessBy}}</label>
                                    </div>
                                    <div class="form-group row csi-view-form-group">
                                        <label class="col-sm-3 custom-details-lebel-left">Vehicle Colour :</label>
                                        <label class="col-sm-3 custom-form-control">{{vehicleRepossession.vehicleColour}}</label>
                                        <label class="col-sm-3 custom-details-lebel-left">Brand Name :</label>
                                        <label class="col-sm-3 custom-form-control" >{{vehicleRepossession.brandName}}</label>
                                    </div>
                                    <!--<div class="form-group row csi-view-form-group">-->
                                        <!--<label class="col-sm-3 custom-details-lebel-left">CL Status :</label>-->
                                        <!--<label class="col-sm-3 custom-form-control">{{vehicleRepossession.clstatus.id}}</label>-->
                                    <!--</div>-->

                                    <button type="button" id="cardRefModalCancelBtn" class="btn btn-danger" data-dismiss="modal">Close</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="form-horizontal csi-view-form" >
                <input name="_csrf" value="" type="hidden">
                <div style="overflow: auto; max-height: 400px;">
                    <table id="vehicleRepossessionTable"
                            class=" table table-striped table-bordered">
                        <thead>
                        <tr>
                            <th>Vehicle Type</th>
                            <th>Vehicle Model</th>
                            <th>Vehicle Registration No</th>
                            <th>Vehicle CC</th>
                            <th>Present Status</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody id="vehicleRepossessionBody">
                            <tr v-for="vehicle in vehicleRepossessionList">
                                <td>{{vehicle.vehicleType}}</td>
                                <td>{{vehicle.vehicleModel}}</td>
                                <td>{{vehicle.vehicleRegistrationNo}}</td>
                                <td>
                                    <a :href="'/collection/dms/document/preview?id=' +vehicle.dmsFileId + '&type='+ vehicle.dmsFileType" style="cursor: pointer"><i fa fa-eye></i>{{vehicle.fileName}}</a>
                                </td>
                                <td>{{vehicle.presentStatus}}</td>
                                <td>
                                    <button type="button" id="view-vehicle-repossession" v-bind:data-id="vehicle.id" data-toggle="modal" data-target="#modal-view-vehicle-repossession" style="margin-right: 3px" class="btn btn-primary btn-xs"><i fa fa-eye></i>View</button>
                                    <button type="button" id="edit-vehicle-repossession-id" v-bind:data-id="vehicle.id" data-toggle="modal" data-target="#modal-vehicle-repossession" class="btn btn-primary btn-xs">Edit</button>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <script>

            vehicleRepossessionApp = new Vue({
                el: '#vehicle-repossession-view-app',
                components: {
                    Multiselect: VueMultiselect.default
                },
                data: {
                    vehicleRepossessionList: [],
                    vehicleRepossession: {},

                    clStatus: [],
                    selectedClStatus: {},
                    isLoading: false
                },
                methods: {
                    formatDateInput: function (date) {
                        let date1 = date ? new Date(date) : new Date()

                        return date ? date1.getFullYear()
                            +'-'+((date1.getMonth()+1) < 10 ? '0'+(date1.getMonth()+1) : (date1.getMonth()+1))
                            +'-'+(date1.getDate() < 10 ? '0'+date1.getDate() : date1.getDate())
                            : '';
                    },
                    formatDate: function (date) {
                        return formatDate_DD_MMM_YYYY(date)
                    }
                }
            })
            $(document).ready(function () {
                $('#vehicleRepossessionForm input[name="_csrf"]').val(csrfToken);
                $('#vehicleRepossessionForm input[name="customerId"]').val(customerId)



                $('#add-vehicle-repossession').click(function () {
                    var formdatalist = $('#referenceInfoSaveForm');
                    $('#vehicle-repossession-save-button').attr('disabled', false);
                    formdatalist.find('input[name="id"]').val('');
                    formdatalist.find('input[name="vehicleType"]').val('');
                    formdatalist.find('input[name="vehicleModel"]').val('');
                    formdatalist.find('input[name="vehicleRegistrationNo"]').val('');
                    formdatalist.find('input[name="vehicleChassisNo"]').val('');
                    formdatalist.find('input[name="vehicleEngineNo"]').val('');
                    formdatalist.find('input[name="yearManufacturing"]').val('');
                    formdatalist.find('input[name="vehicleCC"]').val('');
                    formdatalist.find('input[name="presentStatus"]').val('');
                    formdatalist.find('input[name="agencyHandOverDate"]').val('');
                    formdatalist.find('input[name="repossessionDate"]').val('');
                    formdatalist.find('input[name="clStatusRepossessionDate"]').val('');
                    formdatalist.find('input[name="vehicleReleaseDate"]').val('');
                    formdatalist.find('input[name="samHandoverDate"]').val('');
                    formdatalist.find('input[name="auctionDate"]').val('');
                    formdatalist.find('input[name="agencyName"]').val('');
                    formdatalist.find('input[name="repossessBy"]').val('');
                    formdatalist.find('input[name="vehicleColour"]').val('');
                    formdatalist.find('input[name="brandName"]').val('');
                })

                function vehicleList() {
                    $.getJSON('/customer-loan-profile/vehicle-repossession/list?customerId='+customerId, function (json) {
                        fileData = json;
                        vehicleRepossessionApp.vehicleRepossessionList = json;
                    })
                }

                vehicleList();

                var vehicleRepossession = {};

                $('#vehicleRepossessionForm').on('submit', function (event) {
                    event.preventDefault();
                    var vehicle = new FormData(this);
                    //$('#vehicle-repossession-save-button').attr('disabled', true);
                    var formdatalist = $('#vehicleRepossessionForm');

                    if($('#vehicleRepossessionForm input[name="brandName"]').val() == ""){
                        alert("Brand Name must not be empty");
                        return;
                    }

                    var vehicleType = formdatalist.find('input[name="vehicleType"]').val();
                    var vehicleModel = formdatalist.find('input[name="vehicleModel"]').val();
                    var vehicleRegistrationNo = formdatalist.find('input[name="vehicleRegistrationNo"]').val();
                    var vehicleChassisNo = formdatalist.find('input[name="vehicleChassisNo"]').val();
                    var vehicleEngineNo = formdatalist.find('input[name="vehicleEngineNo"]').val();
                    var yearManufacturing = formdatalist.find('input[name="yearManufacturing"]').val();
                    var vehicleCC = formdatalist.find('input[name="vehicleCC"]').val();
                    var presentStatus = formdatalist.find('input[name="presentStatus"]').val();
                    var agencyHandOverDate = formdatalist.find('input[name="agencyHandOverDate"]').val();
                    var repossessionDate = formdatalist.find('input[name="repossessionDate"]').val();
                    var clStatusRepossessionDate = formdatalist.find('input[name="clStatusRepossessionDate"]').val();
                    var vehicleReleaseDate = formdatalist.find('input[name="vehicleReleaseDate"]').val();
                    var samHandoverDate = formdatalist.find('input[name="samHandoverDate"]').val();
                    var auctionDate = formdatalist.find('input[name="auctionDate"]').val();


                    /*if (vehicleType == '') {
                        $('#vehicle-error-messages').text("Vehicle type can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (vehicleModel == '') {
                        $('#vehicle-error-messages').text("Vehicle Model can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (vehicleRegistrationNo == '') {
                        $('#vehicle-error-messages').text("Vehicle registration No. can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (vehicleChassisNo == '') {
                        $('#vehicle-error-messages').text("Vehicle chassis No. can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (vehicleEngineNo == '') {
                        $('#vehicle-error-messages').text("Vehicle engine No. can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (yearManufacturing == '') {
                        $('#vehicle-error-messages').text("Year of manufacturing can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (vehicleCC == '') {
                        $('#vehicle-error-messages').text("Vehicle CC can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (presentStatus == '') {
                        $('#vehicle-error-messages').text("Present can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (agencyHandOverDate == '') {
                        $('#vehicle-error-messages').text("Agency hand over date can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (repossessionDate == '') {
                        $('#vehicle-error-messages').text("Vehicle repossession date can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (clStatusRepossessionDate == '') {
                        $('#vehicle-error-messages').text("Cl status repossession date can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (vehicleReleaseDate == '') {
                        $('#vehicle-error-messages').text("Vehicle release date can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (samHandoverDate == '') {
                        $('#vehicle-error-messages').text("SAM handover date can not be empty.").removeClass('hidden')
                        return;
                    }

                    if (auctionDate == '') {
                        $('#vehicle-error-messages').text("Auction can not be empty.").removeClass('hidden')
                        return;
                    }*/


                    $.ajax({
                        type: "POST",
                        url: "/customer-loan-profile/vehicle-repossession/save",
                        data: vehicle,
                        enctype: 'multipart/form-data',
                        contentType: false,
                        processData: false,
                        headers: {
                            'X-CSRF-TOKEN': window.csrfToken,
                        },
                        success: function (data) {
                            swal("Success!", "Successfully Saved!", "success");
                            async: false;
                            // $('#vehicleRepossessionForm')[0].reset();
                            $('#vehicleId').val('');
                            $('vehicleType,vehicleModel,vehicleRegistrationNo,vehicleChassisNo,vehicleEngineNo,yearManufacturing,vehicleCC,presentStatus,agencyHandOverDate,repossessionDate,clStatusRepossessionDate,vehicleReleaseDate,samHandoverDate,auctionDate').val('');
                            $('#modal-vehicle-repossession').modal('toggle');
                            vehicleList();
                        },
                        error: function (error) {
                            console.log(error);
                        }
                    });
                });

                function formatDateVehicle(date) {
                    let date1 = date ? new Date(date) : new Date()

                    return date ? date1.getFullYear()
                        +'-'+((date1.getMonth()+1) < 10 ? '0'+(date1.getMonth()+1) : (date1.getMonth()+1))
                        +'-'+(date1.getDate() < 10 ? '0'+date1.getDate() : date1.getDate())
                        : '';
                }

                $('#vehicleRepossessionBody').delegate('#edit-vehicle-repossession-id','click',function () {
                    $.ajax({
                        url: '/customer-loan-profile/vehicle-repossession/find?id='+$(this).data("id"),
                        success: function (response) {
                            vehicleRepossessionApp.vehicleRepossession = response;
                        },
                        error: function (response) {
                            alert('Unsuccessful');
                        }
                    })
                })


                $('#vehicleRepossessionBody').delegate('#view-vehicle-repossession','click',function () {
                    $.ajax({
                        url: '/customer-loan-profile/vehicle-repossession/find?id='+$(this).data("id"),
                        success: function (response) {
                            vehicleRepossessionApp.vehicleRepossession = response;
                        },
                        error: function (response) {
                            alert('Unsuccessful');
                        }
                    })
                })




                $('#add-vehicle-repossession').click(function () {
                    $.ajax({
                        url: '/customer-loan-profile/vehicle-repossession/cl-status',
                        success: function (response) {
                            let options = "<option value=''>Select CL Status</option>";
                            $.each(response, function (index, data) {
                                options += "<option value='"+data.id+"'>"+data.name+"</option>";
                            })
                            $('#vehicle-cLStatusId').html(options);
                        },
                        error: function (response) {
                            alert('Unsuccessful')
                        }
                    })
                })
                $("#yearpeacker").datepicker({
                    format: "yyyy",
                    viewMode: "years",
                    minViewMode: "years",
                    autoclose:true //to close picker once year is selected
                });


            });


        </script>


    </div>
</div>
</body>


</html>
